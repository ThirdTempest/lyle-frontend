let o=[],r=0;const u=4,d=a=>{let e=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},lc:0,listen(l){return t.lc=e.push(l),()=>{for(let i=r+u;i<o.length;)o[i]===l?o.splice(i,u):i+=u;let n=e.indexOf(l);~n&&(e.splice(n,1),--t.lc||t.off())}},notify(l,n){let i=!o.length;for(let c of e)o.push(c,t.value,l,n);if(i){for(r=0;r<o.length;r+=u)o[r](o[r+1],o[r+2],o[r+3]);o.length=0}},off(){},set(l){let n=t.value;n!==l&&(t.value=l,t.notify(n))},subscribe(l){let n=t.listen(l);return l(t.value),n},value:a};return t},g=(a={})=>{let e=d(a);return e.setKey=function(t,l){let n=e.value;typeof l>"u"&&t in e.value?(e.value={...e.value},delete e.value[t],e.notify(n,t)):e.value[t]!==l&&(e.value={...e.value,[t]:l},e.notify(n,t))},e};let f={};if(typeof localStorage<"u")try{f=JSON.parse(localStorage.getItem("cart")||"{}")}catch(a){console.error("Failed to parse cart from localStorage:",a),localStorage.removeItem("cart")}const s=g(f);typeof localStorage<"u"&&s.subscribe(a=>{localStorage.setItem("cart",JSON.stringify(a))});function v(a){const e=s.get()[a.id];e?s.setKey(a.id,{...e,quantity:e.quantity+1}):s.setKey(a.id,{...a,quantity:1})}function p(a){const e=s.get(),{[a]:t,...l}=e;s.set(l)}export{v as a,s as c,p as r};
